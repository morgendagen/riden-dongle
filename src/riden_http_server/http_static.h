// SPDX-FileCopyrightText: 2024 Peder Toftegaard Olsen
//
// SPDX-License-Identifier: MIT

#pragma once

#include <sys/pgmspace.h>

static const char HTML_HEADER[] PROGMEM =
    "<html>"
    "    <head>"
    "        <title>Riden Multi-Purpose WiFi Dongle</title>"
    "        <style>"
    "            body {"
    "                font-family: sans-serif;"
    "                width: 50%;"
    "                min-width: 320px;"
    "                margin: 10px auto 0 auto;"
    "                color: #383428;"
    "            }"
    "            div {"
    "               margin-bottom: 6px;"
    "            }"
    "            div.header {"
    "                margin-bottom: 10px;"
    "            }"
    "            a#configure {float:right;}"
    "            div.box {"
    "                background-color: #E4E4E2;"
    "                margin-top: 10px;"
    "                padding: 4px;"
    "            }"
    "            div.danger {"
    "                background-color: #ED2939;"
    "            }"
    "            .danger {"
    "                color: white;"
    "            }"
    "            .danger a, .danger a:hover, .danger a:active, .danger a:visited {"
    "                color: white;"
    "            }"
    "            .box table {"
    "                width: 100%;"
    "            }"
    "            .box h2 {"
    "                text-align: center;"
    "                margin: 0 0 8px 0;"
    "            }"
    "            .box td,th {"
    "                text-align: left;"
    "            }"
    "            table.info th {text-align: right; padding-right: 10px; width:50%;}"
    "            table.info td {text-align: left; padding-left: 10px; width:50%;}"
    "            table.clients th {text-align: left}"
    "            table.clients td {text-align: left}"
    "            table.clients form {display: inline}"
    "            .bigtext {"
    "              font-size: 3em;"
    "              font-weight: bold;"
    "              font-family: \"Noto Sans Mono\", monospace;"
    "              text-align: right !important;"
    "              white-space: nowrap;"
    "              width: 8ch;"
    "            }"
    "            .onoff {display: block;border-radius: 2px;text-align: center !important;}"
    "            table.control {border-collapse: collapse; width: 100%}"
    "            table.control td, table.control th {padding-left: 10px; padding-right: 10px;}"
    "            table.control th {text-align: center;}"
    "            table.control td:nth-child(2) {text-align: right; white-space: nowrap;}"
    "            table.control td:nth-child(3) {text-align: center;white-space: nowrap;}"
    "            table.scpi {text-align: left; border-collapse: collapse; width: 100%;}"
    "            table.scpi th, table.scpi td {padding: 2px 8px; vertical-align: top;}"
    "            table.scpi th {padding-top: 8px;}"
    "            .onoff button {"
    "              font-size: 1.5em;"
    "              margin: 0px 0px 0px 0px;"
    "              color: white;"
    "              background-color: #666;"
    "              padding: 4px 12px;"
    "              border-radius: 4px;"
    "              border: 1px solid #888;"
    "              cursor: pointer;"
    "            }"
    "            button.is_on {background-color: #0f0 !important;color: black !important;}"
    "            .control button {"
    "              margin: 0px 0px 0px 0px;"
    "              color: white;"
    "              background-color: #666;"
    "              padding: 4px 12px;"
    "              border-radius: 4px;"
    "              border: 1px solid #888;"
    "              cursor: pointer;"
    "            }"
    "            .scpi button {"
    "              margin: 0px 0px 0px 0px;"
    "              color: white;"
    "              background-color: #666;"
    "              padding: 2px 12px;"
    "              border-radius: 4px;"
    "              border: 1px solid #888;"
    "              cursor: pointer;"
    "            }"
    "            textarea {width: 100%;}"
    "            .scpi input[type=\"text\"] {width: 100%;}"
    "            .control input[type=\"text\"] {font-family: \"Noto Sans Mono\", monospace; font-size: 1.2em;}"
    "        </style>"
    "    </head>"
    "    <body>"
    "        <a id='home' href='/'>Home</a>&nbsp;"
    "        <a id='control' href='/control/'>Control</a>"
    "        <a id='configure' href='/config/'>Configure</a>";

static const char HTML_FOOTER[] PROGMEM =
    "    </body>"
    "</html>";

static const char HTML_CONFIG_BODY_1[] PROGMEM =
    "<form method='post'>"
    "    <div class='box'>"
    "        <h2>Dongle Configuration</h2>"
    "        <table class='info'>"
    "            <tbody>"
    "                <tr>"
    "                    <th>Time Zone</th>"
    "                    <td><select name='timezone'>";

static const char HTML_CONFIG_BODY_2[] PROGMEM =
    "                    </select></td>"
    "                </tr>"
    "                <tr>"
    "                    <th>UART baudrate</th>"
    "                    <td><select name='uart_baudrate'>";

static const char HTML_CONFIG_BODY_3[] PROGMEM =
    "                    </select></td>"
    "                </tr>"
    "                <tr><th></th><td><input type='submit' value='Save'></td></tr>"
    "            </tbody>"
    "        </table>"
    "    </div>"
    "</form>"
    "<form method='post' action='/firmware/update/' enctype='multipart/form-data'>"
    "    <div class='box'>"
    "        <h2>Firmware Update</h2>"
    "        <table class='info'>"
    "            <tbody>"
    "                <tr>"
    "                    <th>Firmware .bin file</th>"
    "                    <td><input type='file' name='firmware' accept='.bin,.gz'></td>"
    "                </tr>"
    "                <tr><th></th><td><input type='submit' value='Update'></td></tr>"
    "            </tbody>"
    "        </table>"
    "    </div>"
    "</form>"
    "<div class='box danger'>"
    "    <h2>Danger Zone</h2>"
    "    <a href='/reboot/dongle/'>Reboot Dongle</a><br>"
    "    <a href='/reboot/dongle/?config_portal=true'>Reboot Dongle to Web Configuration Portal</a><br>"
    "</div>";

static const char HTML_REBOOTING_DONGLE_BODY[] PROGMEM =
    "<div class='box'>"
    "    <h2>Dongle is Rebooting</h2>"
    "    <div><p>Redirecting to main page in <span id='counter'>10</span> seconds.</p>"
    "    <p><a href='/'>Return to main page</a></p>"
    "    </div>"
    "</div>"
    "<script>"
    "    setInterval(function() {"
    "        var div = document.querySelector('#counter');"
    "        var count = div.textContent * 1 - 1;"
    "        div.textContent = count;"
    "        if (count <= 0) {"
    "            window.location.replace('/');"
    "        }"
    "    }, 1000);"
    "</script>";

static const char HTML_REBOOTING_DONGLE_UPDATE_BODY[] PROGMEM =
    "<div class='box'>"
    "    <h2>Updated Dongle Firmware</h2>"
    "    <div><p>The dongle is now rebooting.</p>"
    "    <p>Redirecting to main page in <span id='counter'>20</span> seconds.</p>"
    "    <p><a href='/'>Return to main page</a></p>"
    "    </div>"
    "</div>"
    "<script>"
    "    setInterval(function() {"
    "        var div = document.querySelector('#counter');"
    "        var count = div.textContent * 1 - 1;"
    "        div.textContent = count;"
    "        if (count <= 0) {"
    "            window.location.replace('/');"
    "        }"
    "    }, 1000);"
    "</script>";

static const char HTML_DONGLE_UPDATE_1[] PROGMEM =
    "<div class='box'>"
    "    <h2>Dongle Firmware Failed to Update</h2>"
    "    <div><p>The failure is: <b>";

static const char HTML_DONGLE_UPDATE_2[] PROGMEM =
    "</b>."
    "</div>";

static const char HTML_REBOOTING_DONGLE_CONFIG_PORTAL_BODY_1[] PROGMEM =
    "<div class='box'>"
    "    <h2>Dongle is Rebooting</h2>"
    "    <div>An access point named <b>";

static const char HTML_REBOOTING_DONGLE_CONFIG_PORTAL_BODY_2[] PROGMEM =
    "</b> should show up shortly.</div>"
    "    <p>Connect to it and the config portal will show up.</p>";

static const char HTML_NO_CONNECTION_BODY[] PROGMEM =
    "<div class='box'>"
    "    <h2>Unable to communicate with power supply</h2>"
    "    <p>Make sure you have configured the power supply for TTL"
    " at the <a href='/config/'>configured</a> baudrate.</p>"
    "    <p>You must power-cycle the power supply if you modified"
    " its configuration.</p>"
    "</div>";


static const char HTML_CONTROL_BODY[] PROGMEM = 
    "<div class=\"box\">"
    "  <a style=\"float: right\" href=\"/psu/\">Details</a>"
    "  <h2>Power Supply Control</h2>"
    "  <table class=\"control\">"
    "    <tbody>"
    "      <colgroup><col width=\"20%\" /><col width=\"1%\" /><col width=\"1%\" /><col width=\"20%\" /><col width=\"50%\" /></colgroup>"
    "      <tr><th></th><th>Set</th><th></th><th>Output</th><th></th></tr>"
    "      <tr>"
    "        <td></td>"
    "        <td>"
    "          <input type=\"text\" id=\"volts\" size=\"6\" value=\"\" />"
    "        </td>"
    "        <td>"
    "          <button id=\"setv\" onclick=\"setv()\">V-Set &gt;</button>"
    "        </td>"
    "        <td><pre class=\"bigtext\" id=\"outv\">-.--- V</pre></td>"
    "        <td><img id=\"cv\" src=\"data:image/png;base64,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\" style=\"visibility: hidden\" /></td> <!-- CV.png -->"
    "      </tr>"
    "      <tr>"
    "        <td></td>"
    "        <td>"
    "          <input type=\"text\" id=\"amps\" size=\"6\" value=\"\" />"
    "        </td>"
    "        <td>"
    "          <button id=\"seti\" onclick=\"seti()\">I-Set &gt;</button>"
    "        </td>"
    "        <td><pre class=\"bigtext\" id=\"outi\">-.--- A</pre></td>"
    "        <td><img id=\"cc\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAiCAYAAAAtZZsLAAAEDmlDQ1BrQ0dDb2xvclNwYWNlR2VuZXJpY1JHQgAAOI2NVV1oHFUUPpu5syskzoPUpqaSDv41lLRsUtGE2uj+ZbNt3CyTbLRBkMns3Z1pJjPj/KRpKT4UQRDBqOCT4P9bwSchaqvtiy2itFCiBIMo+ND6R6HSFwnruTOzu5O4a73L3PnmnO9+595z7t4LkLgsW5beJQIsGq4t5dPis8fmxMQ6dMF90A190C0rjpUqlSYBG+PCv9rt7yDG3tf2t/f/Z+uuUEcBiN2F2Kw4yiLiZQD+FcWyXYAEQfvICddi+AnEO2ycIOISw7UAVxieD/Cyz5mRMohfRSwoqoz+xNuIB+cj9loEB3Pw2448NaitKSLLRck2q5pOI9O9g/t/tkXda8Tbg0+PszB9FN8DuPaXKnKW4YcQn1Xk3HSIry5ps8UQ/2W5aQnxIwBdu7yFcgrxPsRjVXu8HOh0qao30cArp9SZZxDfg3h1wTzKxu5E/LUxX5wKdX5SnAzmDx4A4OIqLbB69yMesE1pKojLjVdoNsfyiPi45hZmAn3uLWdpOtfQOaVmikEs7ovj8hFWpz7EV6mel0L9Xy23FMYlPYZenAx0yDB1/PX6dledmQjikjkXCxqMJS9WtfFCyH9XtSekEF+2dH+P4tzITduTygGfv58a5VCTH5PtXD7EFZiNyUDBhHnsFTBgE0SQIA9pfFtgo6cKGuhooeilaKH41eDs38Ip+f4At1Rq/sjr6NEwQqb/I/DQqsLvaFUjvAx+eWirddAJZnAj1DFJL0mSg/gcIpPkMBkhoyCSJ8lTZIxk0TpKDjXHliJzZPO50dR5ASNSnzeLvIvod0HG/mdkmOC0z8VKnzcQ2M/Yz2vKldduXjp9bleLu0ZWn7vWc+l0JGcaai10yNrUnXLP/8Jf59ewX+c3Wgz+B34Df+vbVrc16zTMVgp9um9bxEfzPU5kPqUtVWxhs6OiWTVW+gIfywB9uXi7CGcGW/zk98k/kmvJ95IfJn/j3uQ+4c5zn3Kfcd+AyF3gLnJfcl9xH3OfR2rUee80a+6vo7EK5mmXUdyfQlrYLTwoZIU9wsPCZEtP6BWGhAlhL3p2N6sTjRdduwbHsG9kq32sgBepc+xurLPW4T9URpYGJ3ym4+8zA05u44QjST8ZIoVtu3qE7fWmdn5LPdqvgcZz8Ww8BWJ8X3w0PhQ/wnCDGd+LvlHs8dRy6bLLDuKMaZ20tZrqisPJ5ONiCq8yKhYM5cCgKOu66Lsc0aYOtZdo5QCwezI4wm9J/v0X23mlZXOfBjj8Jzv3WrY5D+CsA9D7aMs2gGfjve8ArD6mePZSeCfEYt8CONWDw8FXTxrPqx/r9Vt4biXeANh8vV7/+/16ffMD1N8AuKD/A/8leAvFY9bLAAAAOGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAACoAIABAAAAAEAAAAooAMABAAAAAEAAAAiAAAAABOeXDcAAAOeSURBVFgJ7VhZaBNBGP52k2gSm/QCD/CGUkEpioigggceD+KDaK0XKL6IBQ3SWosPisXrSX0orcWCong8CJaqqEhFPJ7qge2LR4vUolRtSVbTJG12d5xdupO9smrFug8dWOb/vvn/f7/8OzM7WcDljdPrW8p7SYiT9dSI2x9lHm1EZLqYsYz3kAs5EkJcYMRF6W/4Qkqiqt+L10MieWVwBRXX6AJxipb5ngBOBSXM5bxEwdxKKq4uR0YB51ewa1qrmMKhhAfcwxyQEqraja1hMAX1EbtRnKbJ9QK9mlJzz69aDy43bKaNeFCE1HzFyOkRCcBTuknP2Nry2w6Q9me2Y7YCPWs2Ilx/FnxBgW2QRpJUCgLPQ2q6rFGZnorzRSII1xzOcFmswZevEI9UU5FPrB7KIunNDbArunkHEb9+I7/b5Hg/ie7czeLVXOECIhw59rspVL+B1hekb8lqQ57jAY5YVnH4aSt8c2azXyKUR0D6kwyrBq1a3oVzjJN6viA2awbDIIUoFLoZFjs/IF5zkmHN8MwuRqiqQoOI1zVg4NB+hpVVbPuINQ9hzz6I1y5SKGoU62OShLxL5xnOZohdXfixex/k5y0WF6kpHz9kglB1pWVMIxwFilev063cKk4JVhZHrGxAzaPMxWxN+txjK07156IYPHkGsVdtKpTfdlrSOAq0eJsI6f4NEzMMSEU65XH9PjgqcBgP3RAyWkFDOYYBXF/Bv9hmePhP16o1IcJ3DBytHkZ9aIh/OvwnqtTYdMtjSHfo3qtrjhUMNNYDxKdzz5iB2kaM27VTvQJbyjIDJstXXARf+QETOwTHTMO4K7Usj3fxQoufYwWDpRsA+t5FOm0M5DgEy0qNXBaknIhyKiNIlWTe75orP2EC/MuXatC2txwWkFeE3Me34J061TbATMqCgOj85UDvG92QF/yCZch/0KzjnM3k7btIbNtLX62fmaP9kT/2HsKitZA+ZRxZhMmgRy1E59EKGMQpTiLk1keIrlxnirCHyTv3kNhqFKd5WiuojQTp8Wms/fzTXCDTP/lCB4NWg86g/JlW2sz0fadTqcfMwvm4lfgAJCwxf0jQk1D03a9jHJaqw9Cv846Eh/sFbo970CUnR6IYf3SPm+kkziR5cErURHjI3ZCEKbw7vjA0UXEH6WePPkh0xx1q48GTlpCMSf9ZZHM6hYoED3rOVrUxgYrOeZOnEMdXi/Zr/mGfoorau7uZrp+Nh4sl8UGAGgAAAABJRU5ErkJggg==\" style=\"visibility: hidden\" /></td> <!-- CC.png -->"
    "      </tr>"
    "      <tr>"
    "        <td></td>"
    "        <td></td>"
    "        <td></td>"
    "        <td class=\"onoff\">"
    "          <button class=\"is_on\" id=\"toggle\" onclick=\"toggle()\">"
    "            ON/OFF"
    "          </button>"
    "        </td>"
    "        <td><img id=\"batt\" src=\"data:image/png;base64,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\" style=\"visibility: hidden\" /></td> <!-- batt.png -->"
    "      </tr>"
    "    </tbody>"
    "  </table>"
    "</div>"
    "<div class=\"box\">"
    "  <h2>SCPI commands</h2>"
    "  <table class=\"scpi\">"
    "    <tr>"
    "      <td colspan=\"2\">"
    "        Send remote programming (SCPI) commands and queries to the"
    "        instrument and view the responses returned by the instrument.<br />"
    "      </td>"
    "    </tr>"
    "    <tr>"
    "      <th colspan=\"2\">Command</th>"
    "    </tr>"
    "    <tr>"
    "      <td>"
    "        <input type=\"text\" id=\"cmd\" maxlength=\"100\" value=\"\" />"
    "      </td>"
    "      <td width=\"1%\">"
    "        <button id=\"ex\" onclick=\"ex()\">Send</button>"
    "      </td>"
    "    </tr>"
    "    <tr>"
    "      <th colspan=\"2\">History</th>"
    "    </tr>"
    "    <tr>"
    "      <td colspan=\"2\">"
    "        <textarea id=\"r\" rows=\"10\" cols=\"80\" readonly></textarea><br />"
    "        <button style=\"margin-top: 4px\" onclick=\"self.r.value=''; scroll()\">"
    "          Clear history"
    "        </button>"
    "      </td>"
    "    </tr>"
    "  </table>"
    "<script>"
    "  function set_data(data, full_set = false) {"
    "    if (data === \"\") {"
    "      return;"
    "    }"
    "    const obj = JSON.parse(data);"
    "    self.outv.innerHTML = obj.out_v.toFixed(3).padStart(6, \" \") + \" V\";"
    "    self.outi.innerHTML = obj.out_c.toFixed(3).padStart(6, \" \") + \" A\";"
    "    if (full_set) {"
    "      self.volts.value = obj.set_v.toFixed(3);"
    "      self.amps.value = obj.set_c.toFixed(3);"
    "    }"
    "    if (obj.out_on) {"
    "      document.getElementById(\"toggle\").classList.add(\"is_on\");"
    "    } else {"
    "      document.getElementById(\"toggle\").classList.remove(\"is_on\");"
    "    }"
    "    if (obj.cvmode) {"
    "      document.getElementById(\"cc\").style.visibility = \"visible\";"
    "      document.getElementById(\"cv\").style.visibility = \"hidden\";"
    "    } else {"
    "      document.getElementById(\"cc\").style.visibility = \"hidden\";"
    "      document.getElementById(\"cv\").style.visibility = \"visible\";"
    "    }"
    "    if (obj.batt) {"
    "      document.getElementById(\"batt\").style.visibility = \"visible\";"
    "    } else {"
    "      document.getElementById(\"batt\").style.visibility = \"hidden\";"
    "    }"
    "  }"
    ""
    "  function tick(full_set = false) {"
    "    console.log(\"tick\");"
    "    const i = document"
    "      .getElementById(\"toggle\")"
    "      .classList.contains(\"is_on\")"
    "      ? \"false\""
    "      : \"true\";"
    "    const d ="
    "      '{ \"out_v\": 1, \"out_c\": 0, \"set_v\": 12.34, \"set_c\": 1.23, \"out_on\": ' +"
    "      i +"
    "      ', \"cvmode\": ' +"
    "      i +"
    "      ', \"batt\": ' +"
    "      i +"
    "      \" }\";"
    "    set_data(d, full_set);"
    "    return;"
    "    try {"
    "      fetch(\"/status\")"
    "        .then((response) => {"
    "          if (!response.ok) {"
    "            return \"\";"
    "          }"
    "          return response.text();"
    "        })"
    "        .then((data) => {"
    "          if (data !== \"\") {"
    "            set_data(data, full_set);"
    "          } else {"
    "            console.warn(\"No data received from /status\");"
    "          }"
    "        });"
    "    } catch (e) {"
    "      console.error(\"Error fetching status:\", e);"
    "    }"
    "  }"
    ""
    "  function setv() {"
    "    const v = self.volts.value.trim();"
    "    if (v === \"\") {"
    "      alert(\"Please enter a voltage\");"
    "      return;"
    "    }"
    "    document.body.style.cursor = \"wait\";"
    "    try {"
    "      fetch(\"/setv/\" + v).then((response) => {"
    "        if (!response.ok) {"
    "          throw new Error(\"ERR: \" + response.statusText);"
    "        }"
    "      });"
    "    } catch (e) {"
    "      console.error(\"Error setting voltage:\", e);"
    "      alert(\"Error setting voltage: \" + e.message);"
    "    }"
    "    document.body.style.cursor = \"default\";"
    "  }"
    "  function seti() {"
    "    const i = self.amps.value.trim();"
    "    if (i === \"\") {"
    "      alert(\"Please enter a current\");"
    "      return;"
    "    }"
    "    document.body.style.cursor = \"wait\";"
    "    try {"
    "      fetch(\"/seti/\" + i).then((response) => {"
    "        if (!response.ok) {"
    "          throw new Error(\"ERR: \" + response.statusText);"
    "        }"
    "      });"
    "    } catch (e) {"
    "      console.error(\"Error setting current:\", e);"
    "      alert(\"Error setting current: \" + e.message);"
    "    }"
    "    document.body.style.cursor = \"default\";"
    "  }"
    "  function toggle() {"
    "    document.body.style.cursor = \"wait\";"
    "    const i = document"
    "      .getElementById(\"toggle\")"
    "      .classList.contains(\"is_on\")"
    "      ? \"false\""
    "      : \"true\";"
    "    set_data("
    "      '{ \"out_v\": 12.34, \"out_c\": 1.23, \"set_v\": 12.34, \"set_c\": 1.23, \"out_on\": ' +"
    "        i +"
    "        ', \"cvmode\": ' +"
    "        i +"
    "        ', \"batt\": ' +"
    "        i +"
    "        \" }\""
    "    );"
    "    document.body.style.cursor = \"default\";"
    "  }"
    "  function ex() {"
    "    const cmd = self.cmd.value.trim();"
    "    var m = \"/ex/\";"
    "    if (cmd === \"\") {"
    "      alert(\"Please enter a command\");"
    "      return;"
    "    }"
    "    m += cmd;"
    "    self.r.value = \"\\n\" + self.r.value;"
    "    document.body.style.cursor = \"wait\";"
    "    try {"
    "      fetch(m)"
    "        .then((response) => {"
    "          if (!response.ok) {"
    "            throw new Error(\"ERR: \" + response.statusText);"
    "          }"
    "          return response.text();"
    "        })"
    "        .then((data) => {"
    "          if (data !== \"\") {"
    "            self.r.value = \"<= \" + inst + \": \" + data.trim() + \"\\n\" + self.r.value;"
    "          }"
    "          self.r.value = \"=> \" + inst + \": \" + cmd + \"\\n\" + self.r.value;"
    "          scroll();"
    "        });"
    "    } catch (e) {"
    "      console.error(\"Error setting voltage:\", e);"
    "      alert(\"Error setting voltage: \" + e.message);"
    "    }"
    "    document.body.style.cursor = \"default\";"
    "  }"
    "  function scroll() {"
    "    self.r.scrollTop = 0;"
    "  }"
    "  document.querySelector(\"#cmd\").addEventListener(\"keyup\", (event) => {"
    "    if (event.key !== \"Enter\") return;"
    "    document.querySelector(\"#ex\").click();"
    "    event.preventDefault();"
    "  });"
    "  window.addEventListener(\"load\", function () {"
    "    tick(true);"
    "    setInterval(tick, 1000);"
    "  });"
    "      </script>"
    "    </div>";

/**
 * @brief LXI identification document template.
 *
 * Substitution variables:
 *
 * 0 = Model
 * 1 = Serial Number
 * 2 = Firmware Revision
 * 3 = Hostname
 * 4 = IP Address
 * 5 = Subnet mask
 * 6 = MAC Address
 * 7 = IP Gateway
 * 8 = VISA Resource Address 1
 * 9 = VISA Resource Address 2
 */
static const char *LXI_IDENTIFICATION_TEMPLATE = R"==(<?xml version="1.0" encoding="UTF-8" ?>
<LXIDevice xmlns="http://www.lxistandard.org/InstrumentIdentification/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.lxistandard.org/InstrumentIdentification/1.0/LXIIdentification.xsd">
    <Manufacturer>Riden</Manufacturer>
    <Model>${0}</Model>
    <SerialNumber>${1}</SerialNumber>
    <FirmwareRevision>${2}</FirmwareRevision>
    <ManufacturerDescription>Power Supply</ManufacturerDescription>
    <IdentificationURL>http://${3}.local/lxi/identification</IdentificationURL>
    <Interface xsi:type="NetworkInformation" InterfaceType="LXI" IPType="IPv4">
        <InstrumentAddressString>${8}</InstrumentAddressString>
        <InstrumentAddressString>${9}</InstrumentAddressString>
        <Hostname>${3}</Hostname>
        <IPAddress>${4}</IPAddress>
        <SubnetMask>${5}</SubnetMask>
        <MACAddress>${6}</MACAddress>
        <Gateway>${7}</Gateway>
        <DHCPEnabled>true</DHCPEnabled>
        <AutoIPEnabled>true</AutoIPEnabled>
    </Interface>
    <LXIVersion>1.5</LXIVersion>
</LXIDevice>
)==";
